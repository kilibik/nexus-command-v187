<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS TITAN OMEGA | TOTAL RECALL V12</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@800&display=swap');
        
        :root { --nexus-blue: #3b82f6; --nexus-neon: #00ffd5; }
        
        body { background: #010409; color: white; font-family: 'Inter', sans-serif; height: 100vh; display: flex; flex-direction: column; padding: 10px; gap: 10px; overflow: hidden; }
        
        .glass { background: rgba(13, 17, 23, 0.98); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 24px; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        .vip-name { background: linear-gradient(90deg, #fff, var(--nexus-blue), var(--nexus-neon), var(--nexus-blue), #fff); background-size: 200% auto; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: shine 2s linear infinite; font-weight: 900; }
        @keyframes shine { to { background-position: 200% center; } }

        #display { font-family: 'JetBrains Mono'; font-size: clamp(3rem, 15vw, 7rem); color: var(--nexus-blue); font-weight: 900; text-shadow: 0 0 50px rgba(59, 130, 246, 0.4); letter-spacing: -2px; }

        .focus-mode { position: fixed !important; inset: 4% !important; z-index: 10001 !important; background: #0d1117 !important; padding: 30px !important; border: 2px solid var(--nexus-blue); border-radius: 40px; box-shadow: 0 0 200px rgba(0,0,0,1); }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.97); z-index: 10000; display: none; backdrop-filter: blur(15px); }
        
        .medal-box { background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 20px; aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; }
        .medal-box:hover { border-color: var(--nexus-neon); background: rgba(0, 255, 213, 0.1); transform: translateY(-5px); }

        .btn-nexus { position: relative; overflow: hidden; transition: 0.3s; font-weight: 900; text-transform: uppercase; letter-spacing: 2px; }
        .btn-nexus:active { scale: 0.95; }
        
        #loadingBar { height: 4px; width: 0%; background: linear-gradient(90deg, var(--nexus-blue), var(--nexus-neon)); position: fixed; top: 0; left: 0; z-index: 30000; transition: 0.5s; }
        
        .warning-glow { box-shadow: 0 0 100px rgba(239, 68, 68, 0.5) inset; animation: alert-pulse 1s infinite; }
        @keyframes alert-pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

        .admin-input { background: #010409; border: 1px solid rgba(59, 130, 246, 0.3); padding: 15px; border-radius: 15px; color: white; font-weight: 800; width: 100%; text-align: center; }
    </style>
</head>
<body id="mainBody">
    <div id="loadingBar"></div>
    <video id="aiEye" autoplay muted playsinline style="display:none;"></video>
    <div id="aiStatus" class="fixed bottom-8 left-8 z-[10002] bg-blue-600/10 text-blue-400 p-4 rounded-2xl text-[10px] font-black border border-blue-500/30 hidden uppercase tracking-[0.2em]">Sƒ∞STEM G√ñZETƒ∞Mƒ∞ AKTƒ∞F</div>
    <div id="uiOverlay" class="overlay" onclick="closeFocus()"></div>

    <div id="sealSelection" class="overlay flex items-center justify-center p-6" style="z-index: 20000;">
        <div class="glass p-10 w-full max-w-md border-blue-600 border-2 text-center" onclick="event.stopPropagation()">
            <h3 class="text-blue-500 font-black text-2xl mb-2 uppercase tracking-tighter">Zaman Yolculuƒüu</h3>
            <p class="text-slate-400 text-xs mb-8 font-bold uppercase tracking-widest">S√ºreyi Hangi G√ºne M√ºh√ºrleyeceksin?</p>
            <div class="grid gap-4">
                <button onclick="executeSeal('DU')" class="py-6 bg-slate-900 border border-blue-500/20 rounded-3xl font-black text-white hover:bg-blue-600 transition-all uppercase tracking-widest">D√úNE EKLE (GECE MESAƒ∞Sƒ∞)</button>
                <button onclick="executeSeal('BU')" class="py-6 bg-blue-600 rounded-3xl font-black text-white hover:bg-blue-500 transition-all uppercase tracking-widest shadow-lg shadow-blue-600/30">BUG√úNE EKLE (NORMAL)</button>
            </div>
            <button onclick="document.getElementById('sealSelection').style.display='none'" class="mt-8 text-red-500 font-black text-[10px] uppercase tracking-[0.3em] opacity-50 hover:opacity-100">ƒ∞PTAL ET</button>
        </div>
    </div>

    <div id="adminPanel" class="overlay flex items-center justify-center p-6" style="z-index: 25000;">
        <div class="glass p-10 w-full max-w-lg border-red-600 border-2 text-center" onclick="event.stopPropagation()">
            <h2 class="text-red-500 font-black text-3xl mb-6 italic uppercase">MASTER CONTROL</h2>
            <div class="space-y-4">
                <input type="text" id="targetUser" placeholder="HEDEF KULLANICI" class="admin-input">
                <input type="number" id="manualTime" placeholder="S√úRE (DAKƒ∞KA)" class="admin-input">
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="adminUpdate('set')" class="bg-red-600 py-4 rounded-2xl font-black text-xs uppercase">S√úRE SET ET</button>
                    <button onclick="adminUpdate('reset')" class="bg-slate-800 py-4 rounded-2xl font-black text-xs uppercase">SIFIRLA</button>
                </div>
            </div>
            <button onclick="document.getElementById('adminPanel').style.display='none'" class="mt-8 text-white/30 text-[10px] font-black uppercase tracking-widest">√áIKI≈û YAP</button>
        </div>
    </div>

    <div id="loginModal" class="fixed inset-0 bg-[#010409] z-[20000] flex items-center justify-center p-4">
        <div class="glass p-12 w-full max-w-sm border-blue-600 border-2 text-center shadow-2xl">
            <h2 class="text-blue-500 font-black text-4xl mb-10 italic uppercase tracking-tighter">NEXUS OMEGA</h2>
            <input type="text" id="opInput" placeholder="KOD ADINIZI Gƒ∞Rƒ∞N" class="w-full bg-slate-950 border border-blue-500/20 p-6 rounded-3xl mb-6 text-white font-black text-center uppercase outline-none focus:border-blue-400 transition-all">
            <button id="entryBtn" class="w-full py-6 bg-blue-600 text-white rounded-3xl font-black uppercase tracking-[0.5em] hover:bg-blue-500 shadow-xl shadow-blue-900/40">Sƒ∞STEME BAƒûLAN</button>
        </div>
    </div>

    <header class="glass p-6 shrink-0 flex items-center justify-between">
        <div class="flex items-center gap-5">
            <div id="pAvatar" class="w-16 h-16 rounded-full border-2 border-blue-600 bg-slate-900 overflow-hidden shadow-lg shadow-blue-500/30"></div>
            <div>
                <h1 id="userName" class="vip-name text-lg uppercase tracking-widest">OPERAT√ñR...</h1>
                <div class="flex gap-6 mt-2">
                    <span onclick="openQuote()" class="text-[11px] text-blue-400 font-black cursor-pointer uppercase underline decoration-2">üìú DOKTRƒ∞NLER</span>
                    <span onclick="openMedals()" class="text-[11px] text-amber-500 font-black cursor-pointer uppercase underline decoration-2">üéñÔ∏è MADALYALAR</span>
                </div>
            </div>
        </div>
        <div class="hidden md:block text-right">
            <p id="nexusDate" class="text-[10px] text-slate-500 font-black uppercase tracking-widest"></p>
            <p class="text-blue-500 font-black text-xs italic">V12 TOTAL RECALL</p>
        </div>
    </header>

    <div class="flex flex-col md:flex-row gap-4 flex-1 min-h-0 overflow-hidden">
        <aside id="radarPanel" onclick="focusPanel('radarPanel')" class="glass h-1/2 md:h-full md:w-80 p-6 flex flex-col gap-4 overflow-hidden cursor-pointer relative">
            <div class="flex justify-between border-b border-blue-500/10 pb-4">
                <button onclick="switchAside('radar')" id="radarTab" class="text-[11px] font-black text-blue-400 uppercase tracking-widest border-b-2 border-blue-500 pb-2 transition-all">RADAR</button>
                <button onclick="switchAside('leader')" id="leaderTab" class="text-[11px] font-black text-slate-500 uppercase tracking-widest pb-2 transition-all">Lƒ∞DERLER</button>
            </div>
            <div id="radar" class="flex flex-col gap-3 overflow-y-auto no-scrollbar flex-1"></div>
            <div id="leaderboard" class="hidden flex flex-col gap-3 overflow-y-auto no-scrollbar flex-1"></div>
        </aside>

        <section class="glass flex-1 flex flex-col items-center justify-center p-8 relative">
            <div id="display">00:00:00</div>
            <div class="flex gap-8 w-full max-w-md mt-16">
                <button id="startBtn" class="flex-1 py-8 bg-slate-800 text-slate-600 rounded-[40px] font-black text-2xl uppercase tracking-widest cursor-not-allowed border border-white/5">Y√úKLENƒ∞YOR</button>
                <button id="stopBtn" class="hidden flex-1 py-8 bg-red-600 rounded-[40px] font-black text-2xl animate-pulse uppercase tracking-widest text-white shadow-2xl shadow-red-600/50">DURDUR</button>
            </div>
            <button onclick="triggerSealSelection()" class="mt-10 bg-amber-600/10 border-2 border-amber-500/30 px-10 py-4 rounded-3xl text-[11px] font-black text-amber-500 uppercase hover:bg-amber-600 hover:text-white transition-all shadow-lg">G√úN√ú M√úH√úRLE</button>
        </section>
    </div>

    <footer id="chartPanel" onclick="focusPanel('chartPanel')" class="glass h-36 p-4 shrink-0 cursor-pointer overflow-hidden">
        <canvas id="mainChart"></canvas>
    </footer>

    <div id="nexusModal" class="fixed inset-0 bg-black/99 z-[15000] hidden items-center justify-center p-4">
        <div class="bg-[#0d1117] border-2 border-blue-600 p-10 rounded-[50px] w-full max-w-3xl text-center relative max-h-[90vh] flex flex-col overflow-hidden shadow-[0_0_100px_rgba(59,130,246,0.2)]">
            
            <div id="medalGrid" class="grid grid-cols-4 sm:grid-cols-5 gap-4 hidden overflow-y-auto no-scrollbar p-2"></div>
            
            <div id="medalDetail" class="hidden flex-1 flex flex-col items-center justify-center scale-up-center">
                <div id="detIcon" class="text-[10rem] mb-10 filter drop-shadow-[0_0_40px_rgba(0,255,213,0.4)]"></div>
                <h2 id="detTitle" class="text-amber-500 font-black text-4xl mb-6 uppercase tracking-tighter italic"></h2>
                <p id="detDesc" class="text-slate-200 text-2xl italic leading-relaxed px-12 font-medium"></p>
                <button onclick="showMedalList()" class="mt-12 text-blue-400 font-black text-xs uppercase underline tracking-[0.2em]">KOLEKSƒ∞YONA D√ñN</button>
            </div>

            <div id="profileView" class="hidden flex-1 flex flex-col overflow-hidden">
                <div id="pUserIcon" class="w-24 h-24 mx-auto rounded-full border-4 border-blue-600 mb-6 overflow-hidden bg-slate-950"></div>
                <h2 id="pUserName" class="text-blue-400 font-black text-3xl mb-4 uppercase italic tracking-widest"></h2>
                <div class="flex-1 bg-slate-900/80 rounded-[40px] p-6 min-h-[350px] border border-slate-800 mb-6">
                    <canvas id="profileChart"></canvas>
                </div>
            </div>

            <div id="standardView" class="flex-1 flex flex-col items-center justify-center">
                <div id="mIcon" class="text-[8rem] mb-10 drop-shadow-[0_0_20px_rgba(59,130,246,0.3)]">üìú</div>
                <h2 id="mTitle" class="text-blue-500 font-black text-3xl mb-6 uppercase tracking-tighter italic">NEXUS DOKTRƒ∞Nƒ∞</h2>
                <p id="quoteText" class="text-slate-200 text-xl italic leading-relaxed px-10 font-medium"></p>
            </div>

            <button onclick="closeModal()" class="w-full py-6 bg-blue-600 text-white rounded-[25px] font-black text-sm uppercase mt-8 tracking-[0.4em] hover:bg-blue-500 transition-all">PROTOKOL√ú KAPAT</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, update, onValue, get, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = { 
            apiKey: "AIzaSy...", 
            authDomain: "yks-odak.firebaseapp.com", 
            projectId: "yks-odak", 
            databaseURL: "https://yks-odak-default-rtdb.europe-west1.firebasedatabase.app" 
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        let MY_NAME = localStorage.getItem('nexus_user'), timerInterval, myChart, profChart, modelsLoaded = false, aiInterval, faceNotFoundCount = 0;
        const MAX_TOLERANCE = 4; // Kafa eƒüikliƒüi i√ßin daha geni≈ü tolerans

        // üìú 40 ADET DOKTRƒ∞N (TAM HAVUZ)
        const DOKTRIN = [
            "Zafer; terini kandan, uykusunu hayallerinden ayƒ±ramayanlarƒ±n tek sadƒ±k dostudur.",
            "Nikola Tesla'nƒ±n zihnindeki fƒ±rtƒ±nalar, o masadaki mutlak sessizlikte dindi.",
            "Acƒ± seni terk edene kadar o masadan kalkmayacaksƒ±n.",
            "Rakiplerinin uyuduƒüu her saniye, senin zirveye giden basamaƒüƒ±ndƒ±r.",
            "M√ºkemmellik bir anlƒ±k eylem deƒüil, her g√ºn tekrarlanan bir alƒ±≈ükanlƒ±ktƒ±r.",
            "Zayƒ±flƒ±k, masadan kalktƒ±ƒüƒ±n an ba≈ülar. G√º√ß ise 'bir sayfa daha' diyebildiƒüin e≈üiktedir.",
            "Zaman, geri alƒ±namayan tek sermayendir. Onu √ßar√ßur eden geleceƒüini yakar.",
            "Senin rakiplerin ≈üu an bir bahane uyduruyor. Sen ise tarih yazƒ±yorsun.",
            "Bug√ºn hissettiƒüin yorgunluk, yarƒ±nki pi≈ümanlƒ±ktan √ßok daha hafiftir.",
            "Masa senin sava≈ü alanƒ±ndƒ±r. Kitaplar silahlarƒ±n, kalemlerin ise cephanendir.",
            "ƒ∞rade bir kastƒ±r; zorlamadƒ±k√ßa b√ºy√ºmez.",
            "Konfor alanƒ±, muhte≈üem fikirlerin ve hayallerin √∂ld√ºƒü√º bir mezarlƒ±ktƒ±r.",
            "Gelecekteki 'sen', bug√ºnk√º 'sen'e g√∂zya≈ülarƒ± i√ßinde te≈üekk√ºr etmeli.",
            "Sƒ±nƒ±rlar zihindedir, masada deƒüil. Zihnini a≈üarsan d√ºnyayƒ± a≈üarsƒ±n.",
            "Bir aslan avƒ±na odaklandƒ±ƒüƒ±nda √ßevresindeki hi√ßbir g√ºr√ºlt√ºy√º duymaz.",
            "Disiplin, √∂zg√ºrl√ºƒü√ºn tek ger√ßek anahtarƒ±dƒ±r.",
            "Ba≈üarƒ± merdivenlerini ellerin cebinde tƒ±rmanamazsƒ±n.",
            "O kitap bittiƒüinde sen de deƒüi≈ümi≈ü olacaksƒ±n.",
            "Yorgunluk ge√ßer, ama bitirememenin verdiƒüi o eziklik √∂m√ºr boyu s√ºrer.",
            "Karanlƒ±ƒüa k√ºfretmektense bir mum yak. O mum senin kalemindir.",
            "≈ûu an √ßalƒ±≈ümadƒ±ƒüƒ±n her saniye i√ßin bir bedel √∂deyeceksin.",
            "Acƒ± √ßekmekten korkma. Acƒ±, potansiyelinin geni≈üleme sesidir.",
            "En iyi intikam, devasa bir ba≈üarƒ±dƒ±r.",
            "Seni durdurabilecek tek ki≈üi, aynada g√∂rd√ºƒü√ºn o ki≈üidir.",
            "≈ûampiyonlar salonlarda deƒüil, kendilerinden bir ≈üey daha kattƒ±klarƒ± o masalarda doƒüar.",
            "Kartallar sadece y√ºkseƒüe u√ßmaz, fƒ±rtƒ±nada bile kanat √ßƒ±rparlar.",
            "Bir g√ºn her ≈üey bittiƒüinde, 'iyi ki' demek i√ßin ≈üimdi 'ke≈üke'lerini feda et.",
            "Zeka seni ba≈ülatƒ±r, disiplin seni biti≈ü √ßizgisine g√∂t√ºr√ºr.",
            "D√ºnyanƒ±n en iyi planƒ± bile, uygulama olmadan bir hi√ßtir.",
            "Sen bir kurban deƒüil, kendi hayatƒ±nƒ±n mimarƒ±sƒ±n.",
            "Odanƒ±n i√ßindeki sessizlik, geleceƒüindeki alkƒ±≈ü seslerinin hazƒ±rlƒ±ƒüƒ±dƒ±r.",
            "Hedefin g√ºne≈ü olsun, ƒ±skalarsan bile yƒ±ldƒ±zlarƒ±n arasƒ±nda kalƒ±rsƒ±n.",
            "Vazge√ßmek i√ßin her zaman bir nedenin olacak, ama devam etmek i√ßin tek bir hayalin var.",
            "Ka√ßtƒ±ƒüƒ±n her zorluk, ileride kar≈üƒ±na daha b√ºy√ºk bir canavar olarak √ßƒ±kacak.",
            "Odaklanma, g√ºr√ºlt√ºye raƒümen fƒ±sƒ±ltƒ±yƒ± duyabilmektir.",
            "ƒ∞nsanlar ne dediƒüine deƒüil, neyi ba≈üardƒ±ƒüƒ±na bakarlar.",
            "Zirve soƒüuktur ama manzarasƒ± muhte≈üemdir.",
            "Sabah uyandƒ±ƒüƒ±nda bir amacƒ±n yoksa, uyanmanƒ±n da bir anlamƒ± yoktur.",
            "Her g√ºn %1 daha iyi ol. Yƒ±l sonunda dev bir devrim yapmƒ±≈ü olacaksƒ±n.",
            "Nexus Titan Protokol√º asla uyumaz. Sen de uyuma."
        ];

        // üéñÔ∏è 20 ADET MADALYA (TAM HAVUZ)
        const MEDALS = [
            {i:'üëë', t:'NEXUS KRALI', d:'500+ saat toplam odaklanma s√ºresi. Nexus evreninin mutlak hakimi.'},
            {i:'‚öîÔ∏è', t:'GLADYAT√ñR', d:'G√ºnde 10 saatten fazla √ßalƒ±≈üarak arenayƒ± domine eden efsanevi sava≈ü√ßƒ±.'},
            {i:'üíé', t:'ELMAS ƒ∞RADE', d:'Kesintisiz 3 saat mola vermeden odaklanmayƒ± ba≈üaran ultra disiplinli zihin.'},
            {i:'üõ°Ô∏è', t:'MUHAFIZ', d:'Gece 04:00\'e kadar masada kalarak kutsal n√∂beti s√ºrd√ºren gece operat√∂r√º.'},
            {i:'üî•', t:'ALEV ALAN', d:'7 g√ºn boyunca √ºst √ºste m√ºh√ºrleme yapan sarsƒ±lmaz istikrar abidesi.'},
            {i:'üå™Ô∏è', t:'FIRTINA', d:'Tek bir g√ºnde 12 saatlik √ßalƒ±≈üma barajƒ±nƒ± yƒ±kan, durdurulamaz doƒüal afet.'},
            {i:'ü¶æ', t:'CYBORG', d:'Duygularƒ±ndan arƒ±nmƒ±≈ü, sadece sonuca odaklƒ± haftalƒ±k 70 saat mesai canavarƒ±.'},
            {i:'ü¶Å', t:'ASLAN', d:'Cesaretiyle en zor konulardan bile ka√ßmayan, korkusuz lider ruhlu operat√∂r.'},
            {i:'ü¶â', t:'GECE BAYKU≈ûU', d:'G√ºne≈ü battƒ±ktan sonra verimliliƒüi zirve yapan karanlƒ±klarƒ±n efendisi.'},
            {i:'‚ö°', t:'YILDIRIM', d:'Sabah 06:00\'da ilk giri≈üi yapan, ≈üafak operasyonu uzmanƒ± erken kalkan.'},
            {i:'üßò', t:'ZEN USTASI', d:'Derin odak modunda 100 saat ge√ßirmi≈ü, zihnini tamamen susturabilen bilge.'},
            {i:'ü¶Ö', t:'KARTAL G√ñZ√ú', d:'G√∂z√ºn√º kitaptan bir saniye bile ayƒ±rmayan, saniyede binlerce veri i≈üleyen dikkat.'},
            {i:'üèõÔ∏è', t:'Mƒ∞MAR', d:'Programƒ±na saniye saniye sadƒ±k kalan, kendi ba≈üarƒ±sƒ±nƒ± milim milim in≈üa eden deha.'},
            {i:'üèπ', t:'AVCI', d:'Hedeflediƒüi konuyu bitirmeden masadan asla kalkmayan, avƒ±nƒ± bƒ±rakmayan takip√ßi.'},
            {i:'üåã', t:'VOLKAN', d:'√áalƒ±≈ümaya ba≈üladƒ±ƒüƒ±nda √ßevresindeki her ≈üeyi ƒ±sƒ±tan, durdurulamaz bir enerji odaƒüƒ±.'},
            {i:'‚ùÑÔ∏è', t:'SOƒûUKKANLI', d:'Baskƒ± altƒ±nda odaƒüƒ±nƒ± bozmayan, sƒ±nav stresini buz gibi bir iradeyle y√∂neten.'},
            {i:'‚õ©Ô∏è', t:'SHOGUN', d:'Liderlik tablosunda haftalarca zirveyi kimseye bƒ±rakmayan mutlak otorite.'},
            {i:'üî≠', t:'KA≈ûƒ∞F', d:'Yeni √ßalƒ±≈üma metodlarƒ±nƒ± ba≈üarƒ±yla ke≈üfedip sisteme adapte eden yenilik√ßi zihin.'},
            {i:'üß™', t:'Sƒ∞MYACI', d:'Yorgunluƒüu, uykusuzluƒüu ve stresi altƒ±na (ba≈üarƒ±ya) d√∂n√º≈üt√ºren d√∂n√º≈ü√ºm ustasƒ±.'},
            {i:'üåå', t:'OMEGA', d:'Nexus sisteminin t√ºm sƒ±rlarƒ±na ve seviyelerine vakƒ±f olmu≈ü son a≈üama operat√∂r.'}
        ];

        async function loadAiModels() {
            const bar = document.getElementById('loadingBar');
            const btn = document.getElementById('startBtn');
            try {
                const URL = 'https://justadudewhohacks.github.io/face-api.js/weights';
                bar.style.width = "40%";
                await faceapi.nets.tinyFaceDetector.loadFromUri(URL);
                bar.style.width = "100%";
                modelsLoaded = true;
                btn.innerText = "ODAKLAN";
                btn.className = "flex-1 py-8 bg-blue-600 text-white rounded-[40px] font-black text-2xl uppercase tracking-widest shadow-2xl shadow-blue-600/30";
                setTimeout(() => bar.style.display = 'none', 1000);
            } catch (e) { alert("AI Y√ºkleme Hatasƒ±!"); }
        }

        async function startAiEye() {
            const video = document.getElementById('aiEye');
            const status = document.getElementById('aiStatus');
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
                status.style.display = 'block';
                faceNotFoundCount = 0;
                
                aiInterval = setInterval(async () => {
                    if(!video.srcObject) return;
                    const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions({ inputSize: 160, scoreThreshold: 0.1 }));
                    
                    if (detections.length === 0) {
                        faceNotFoundCount++;
                        status.innerText = `OPERAT√ñR ARANIYOR (${MAX_TOLERANCE - faceNotFoundCount + 1})`;
                        status.classList.replace('text-blue-400', 'text-red-500');
                        document.getElementById('mainBody').classList.add('warning-glow');
                        if (faceNotFoundCount >= MAX_TOLERANCE) { document.getElementById('stopBtn').click(); }
                    } else {
                        faceNotFoundCount = 0;
                        status.innerText = "Sƒ∞STEM G√ñZETƒ∞Mƒ∞: AKTƒ∞F";
                        status.classList.replace('text-red-500', 'text-blue-400');
                        document.getElementById('mainBody').classList.remove('warning-glow');
                    }
                }, 5000);
            } catch (e) { alert("Kamera izni gerekli!"); }
        }

        function drawChart(id, history, isMain) {
            const ctx = document.getElementById(id).getContext('2d');
            const days = ['Pzt','Sal','√áar','Per','Cum','Cmt','Paz'];
            const data = days.map(d => Math.floor((history[d]||0)/60000));
            const config = {
                type: 'bar',
                data: { labels: days, datasets: [{ data, backgroundColor: '#3b82f6', borderRadius: 15 }] },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false }, ticks: { color: '#475569', font: { weight: '900', size: 10 } } } } }
            };
            if(isMain) { if(myChart) myChart.destroy(); myChart = new Chart(ctx, config); }
            else { if(profChart) profChart.destroy(); profChart = new Chart(ctx, config); }
        }

        // --- M√úH√úRLEME Sƒ∞STEMƒ∞ (V12 √ñZEL) ---
        window.triggerSealSelection = () => {
            document.getElementById('sealSelection').style.display = 'flex';
        };

        window.executeSeal = (type) => {
            const days = ['Paz','Pzt','Sal','√áar','Per','Cum','Cmt'];
            let n = new Date().getDay();
            if(type === 'DU') n = n === 0 ? 6 : n - 1; // D√ºne git
            
            const target = days[n];
            get(ref(db, `users/${MY_NAME}`)).then(s => {
                const v = s.val() || {}, h = v.history || {};
                h[target] = (h[target] || 0) + (v.pendingTime || 0);
                update(ref(db, `users/${MY_NAME}`), { pendingTime: 0, timerActive: false, history: h });
                document.getElementById('sealSelection').style.display = 'none';
                alert(`S√ºre ${target} g√ºn√ºne m√ºh√ºrlendi.`);
            });
        };

        // --- MODERAT√ñR (ADMIN) FONKSƒ∞YONLARI ---
        window.adminUpdate = (action) => {
            const user = document.getElementById('targetUser').value.trim().toUpperCase();
            const mins = parseInt(document.getElementById('manualTime').value) || 0;
            if(!user) return;
            
            if(action === 'set') {
                update(ref(db, `users/${user}`), { pendingTime: mins * 60000 });
                alert(`${user} s√ºresi ${mins} dakika yapƒ±ldƒ±.`);
            } else {
                set(ref(db, `users/${user}/history`), {});
                update(ref(db, `users/${user}`), { pendingTime: 0 });
                alert(`${user} verileri sƒ±fƒ±rlandƒ±.`);
            }
        };

        window.addEventListener('keydown', (e) => {
            if(e.key.toLowerCase() === 'l') {
                const pass = prompt("Sƒ∞STEM ≈ûƒ∞FRESƒ∞:");
                if(pass === "1905") document.getElementById('adminPanel').style.display = 'flex';
            }
        });

        // --- Dƒ∞ƒûER FONKSƒ∞YONLAR ---
        window.openProfile = (name) => {
            get(ref(db, `users/${name}`)).then(s => {
                const d = s.val() || {};
                document.getElementById('pUserName').innerText = name;
                document.getElementById('pUserIcon').innerHTML = `<img src="https://api.dicebear.com/7.x/bottts/svg?seed=${name}">`;
                document.getElementById('standardView').classList.add('hidden');
                document.getElementById('medalGrid').classList.add('hidden');
                document.getElementById('profileView').classList.remove('hidden');
                document.getElementById('nexusModal').classList.replace('hidden', 'flex');
                drawChart('profileChart', d.history || {}, false);
            });
        };

        window.openMedals = () => {
            const grid = document.getElementById('medalGrid');
            grid.innerHTML = MEDALS.map((m, idx) => `<div class="medal-box" onclick="zoomMedal(${idx})"><span class="text-3xl">${m.i}</span><span class="text-[9px] font-black mt-2 text-blue-400 uppercase">${m.t}</span></div>`).join('');
            document.getElementById('profileView').classList.add('hidden');
            document.getElementById('standardView').classList.add('hidden');
            document.getElementById('medalDetail').classList.add('hidden');
            grid.classList.remove('hidden');
            document.getElementById('nexusModal').classList.replace('hidden', 'flex');
        };

        window.zoomMedal = (idx) => {
            const m = MEDALS[idx];
            document.getElementById('detIcon').innerText = m.i;
            document.getElementById('detTitle').innerText = m.t;
            document.getElementById('detDesc').innerText = m.d;
            document.getElementById('medalGrid').classList.add('hidden');
            document.getElementById('medalDetail').classList.remove('hidden');
        };

        window.showMedalList = () => {
            document.getElementById('medalDetail').classList.add('hidden');
            document.getElementById('medalGrid').classList.remove('hidden');
        };

        window.openQuote = () => {
            document.getElementById('quoteText').innerText = DOKTRIN[Math.floor(Math.random()*DOKTRIN.length)];
            document.getElementById('profileView').classList.add('hidden');
            document.getElementById('medalGrid').classList.add('hidden');
            document.getElementById('medalDetail').classList.add('hidden');
            document.getElementById('standardView').classList.remove('hidden');
            document.getElementById('nexusModal').classList.replace('hidden', 'flex');
        };

        function initNexus() {
            loadAiModels();
            document.getElementById('nexusDate').innerText = new Date().toLocaleDateString('tr-TR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            onValue(ref(db, `users/${MY_NAME}`), (s) => {
                const d = s.val() || {};
                document.getElementById('userName').innerText = MY_NAME;
                document.getElementById('pAvatar').innerHTML = `<img src="https://api.dicebear.com/7.x/bottts/svg?seed=${MY_NAME}">`;
                if(timerInterval) clearInterval(timerInterval);
                if(d.timerActive) {
                    document.getElementById('startBtn').classList.add('hidden'); document.getElementById('stopBtn').classList.remove('hidden');
                    timerInterval = setInterval(() => {
                        const ms = (d.pendingTime || 0) + (Date.now() - d.startTime);
                        const h = Math.floor(ms/3600000).toString().padStart(2,'0'), m = Math.floor((ms%3600000)/60000).toString().padStart(2,'0'), sc = Math.floor((ms%60000)/1000).toString().padStart(2,'0');
                        document.getElementById('display').innerText = `${h}:${m}:${sc}`;
                    }, 1000);
                } else {
                    document.getElementById('startBtn').classList.remove('hidden'); document.getElementById('stopBtn').classList.add('hidden');
                    const ms = d.pendingTime || 0;
                    const h = Math.floor(ms/3600000).toString().padStart(2,'0'), m = Math.floor((ms%3600000)/60000).toString().padStart(2,'0'), sc = Math.floor((ms%60000)/1000).toString().padStart(2,'0');
                    document.getElementById('display').innerText = `${h}:${m}:${sc}`;
                }
                drawChart('mainChart', d.history || {}, true);
            });

            onValue(ref(db, 'users'), (s) => {
                const users = s.val() || {};
                const radar = document.getElementById('radar');
                const leader = document.getElementById('leaderboard');
                radar.innerHTML = ""; leader.innerHTML = "";
                const userList = Object.entries(users).sort((a,b) => (b[1].pendingTime||0) - (a[1].pendingTime||0));
                
                userList.forEach(([name, u], idx) => {
                    const rDiv = document.createElement('div');
                    rDiv.className = `p-5 glass flex justify-between items-center mb-1 ${u.timerActive ? 'border-l-4 border-green-500 bg-green-500/5' : ''}`;
                    rDiv.onclick = () => openProfile(name);
                    rDiv.innerHTML = `<span class='text-[10px] font-black'>${name}</span><span class='text-[9px] ${u.timerActive ? 'text-green-400' : 'text-slate-600'}'>${u.timerActive ? '‚óè AKTƒ∞F' : '√áEVRƒ∞MDI≈ûI'}</span>`;
                    radar.appendChild(rDiv);

                    const lDiv = document.createElement('div');
                    lDiv.className = "p-5 glass flex justify-between items-center mb-1";
                    lDiv.innerHTML = `<span class='text-[10px] font-black'>#${idx+1} ${name}</span><span class='text-[11px] text-amber-500 font-black'>${Math.floor((u.pendingTime||0)/60000)} DK</span>`;
                    leader.appendChild(lDiv);
                });
            });
        }

        document.getElementById('entryBtn').onclick = async () => {
            const name = document.getElementById('opInput').value.trim().toUpperCase();
            if(name.length < 2) return;
            localStorage.setItem('nexus_user', name); MY_NAME = name;
            await update(ref(db, `users/${name}`), { name, avatar: `https://api.dicebear.com/7.x/bottts/svg?seed=${name}` });
            document.getElementById('loginModal').style.display = 'none';
            initNexus();
        };

        document.getElementById('startBtn').onclick = () => { if(modelsLoaded) { startAiEye(); update(ref(db, `users/${MY_NAME}`), { timerActive: true, startTime: Date.now() }); } };
        document.getElementById('stopBtn').onclick = () => {
            clearInterval(aiInterval);
            const video = document.getElementById('aiEye'); if(video.srcObject) video.srcObject.getTracks().forEach(t => t.stop());
            document.getElementById('aiStatus').style.display = 'none';
            document.getElementById('mainBody').classList.remove('warning-glow');
            get(ref(db, `users/${MY_NAME}`)).then(s => { const v = s.val(); update(ref(db, `users/${MY_NAME}`), { timerActive: false, pendingTime: (v.pendingTime || 0) + (Date.now() - v.startTime) }); });
        };

        window.switchAside = (t) => {
            document.getElementById('radar').classList.toggle('hidden', t==='leader');
            document.getElementById('leaderboard').classList.toggle('hidden', t==='radar');
            document.getElementById('radarTab').className = t==='radar' ? "text-[11px] font-black text-blue-400 border-b-2 border-blue-500 pb-2 transition-all" : "text-[11px] font-black text-slate-500 pb-2 transition-all";
            document.getElementById('leaderTab').className = t==='leader' ? "text-[11px] font-black text-amber-500 border-b-2 border-amber-500 pb-2 transition-all" : "text-[11px] font-black text-slate-500 pb-2 transition-all";
        };

        window.closeModal = () => document.getElementById('nexusModal').classList.replace('flex', 'hidden');
        window.focusPanel = (id) => { document.getElementById('uiOverlay').style.display='block'; document.getElementById(id).classList.add('focus-mode'); };
        window.closeFocus = () => { document.getElementById('uiOverlay').style.display='none'; document.querySelectorAll('.focus-mode').forEach(e=>e.classList.remove('focus-mode')); };

        if(MY_NAME) { document.getElementById('loginModal').style.display = 'none'; initNexus(); }
    </script>
</body>
</html>
